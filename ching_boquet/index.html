<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive SVG Favicon Garden</title>
  <style>
    :root{
      --sky1:#050b18;
      --sky2:#102040;
      --meadow:#06230f;
      --meadow2:#0a2f16;
      --cardW:min(300px, 86vw);
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      overflow:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 30% 20%, rgba(120,160,255,.12), transparent 55%),
                  linear-gradient(to bottom, var(--sky1), var(--sky2));
      color:#0b1020;
    }

    /* Scene */
    .scene{
      position:relative;
      width:100vw;
      height:100vh;
      isolation:isolate;
    }

    /* Stars */
    .stars{
      position:absolute; inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .star{
      position:absolute;
      width:2px;height:2px;border-radius:999px;
      background:rgba(255,255,255,.9);
      filter: drop-shadow(0 0 6px rgba(255,255,255,.35));
      animation: twinkle var(--tw) ease-in-out infinite;
      opacity:.6;
    }
    @keyframes twinkle{
      0%,100%{transform:scale(.7); opacity:.35}
      50%{transform:scale(1.35); opacity:.95}
    }

    /* Meadow (small height to avoid dead space) */
    .meadow{
      position:absolute;
      left:0; right:0; bottom:0;
      height:18vh;
      background: linear-gradient(to top, var(--meadow), var(--meadow2));
      box-shadow: 0 -18px 40px rgba(0,0,0,.25) inset;
      z-index:1;
    }
    .meadow:before{
      content:"";
      position:absolute; inset:-10vh -5vw 0 -5vw;
      background:
        radial-gradient(120px 60px at 12% 100%, rgba(16,90,40,.55), transparent 60%),
        radial-gradient(160px 70px at 35% 100%, rgba(20,110,55,.45), transparent 65%),
        radial-gradient(140px 70px at 58% 100%, rgba(10,70,30,.52), transparent 62%),
        radial-gradient(180px 80px at 82% 100%, rgba(18,95,45,.50), transparent 65%);
      filter: blur(1px);
      opacity:.9;
      pointer-events:none;
    }

    /* Garden layer */
    .garden{
      position:absolute;
      left:0; right:0; bottom:0;
      height:100vh;
      z-index:2;
      transform-origin: 50% 55%;
      transition: transform 700ms cubic-bezier(.2,.9,.18,1);
      will-change: transform;
    }
    .garden.is-zoomed{
      cursor: default;
    }

    /* Ribbon overlay */
    .ribbon-layer{
      position:absolute; inset:0;
      z-index:6;
      pointer-events:none;
    }
    .ribbon-path{
      fill:none;
      stroke: rgba(255,255,255,.92);
      stroke-width: 3.5;
      stroke-linecap: round;
      stroke-linejoin: round;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
    }

    /* Polaroid UI */
    .ui{
      position:absolute; inset:0;
      z-index:7;
      display:flex;
      align-items:flex-start;
      justify-content:flex-end;
      padding: max(3vh, 18px) max(3vw, 18px);
      pointer-events:none;
    }
    .card{
      width:var(--cardW);
      background:#fff;
      border-radius:16px;
      padding:14px 14px 18px;
      box-shadow: 0 24px 80px rgba(0,0,0,.35);
      transform: translateY(-8px) scale(.98);
      opacity:0;
      transition: opacity 320ms ease, transform 520ms cubic-bezier(.2,.9,.18,1);
      position:relative;
      pointer-events:auto;
    }
    .card.show{
      opacity:1;
      transform: translateY(0) scale(1);
    }
    .photo{
      height: 160px;
      border-radius:12px;
      background:
        radial-gradient(420px 220px at 30% 20%, rgba(80,120,255,.18), transparent 55%),
        linear-gradient(to bottom, #0b1020, #132a52);
      position:relative;
      overflow:hidden;
      border: 1px solid rgba(10,15,35,.08);
    }
    .photo:before{
      content:"";
      position:absolute; inset:-20% -20%;
      background:
        radial-gradient(2px 2px at 12% 22%, rgba(255,255,255,.9), transparent 55%),
        radial-gradient(2px 2px at 42% 35%, rgba(255,255,255,.7), transparent 55%),
        radial-gradient(2px 2px at 70% 28%, rgba(255,255,255,.8), transparent 55%),
        radial-gradient(2px 2px at 85% 48%, rgba(255,255,255,.75), transparent 55%),
        radial-gradient(2px 2px at 25% 70%, rgba(255,255,255,.7), transparent 55%),
        radial-gradient(2px 2px at 62% 78%, rgba(255,255,255,.85), transparent 55%);
      opacity:.65;
      animation: photoTwinkle 4.4s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes photoTwinkle{
      0%,100%{transform:translateY(0); opacity:.5}
      50%{transform:translateY(-6px); opacity:.85}
    }
    .caption{
      margin-top:12px;
      padding: 0 6px;
      color:#121a34;
    }
    .caption h3{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .caption p{
      margin:6px 0 0;
      font-size: 13px;
      line-height: 1.35;
      color: rgba(18,26,52,.78);
    }

    /* CRUCIAL FIX: close button */
    .close{
      position:absolute;
      top:-20px;
      right:-20px;
      z-index:999;
      pointer-events:auto;
      width:42px;height:42px;
      border-radius:999px;
      border:0;
      background:#ffffff;
      box-shadow: 0 14px 40px rgba(0,0,0,.28);
      display:grid;
      place-items:center;
      cursor:pointer;
      transition: transform 160ms ease;
    }
    .close:active{transform:scale(.96)}
    .close svg{width:18px;height:18px}

    /* Flowers layout */
    svg#gardenSVG{
      position:absolute;
      left:0; top:0;
      width:100%;
      height:100%;
    }

    .flower{
      cursor:pointer;
      transform-origin: center bottom;
      filter: drop-shadow(0 18px 22px rgba(0,0,0,.22));
    }

    /* No-dead-animation: each element sways with unique timing */
    .sway-a{ animation: swayA 5.6s ease-in-out infinite; }
    .sway-b{ animation: swayB 6.8s ease-in-out infinite; }
    .sway-c{ animation: swayC 7.4s ease-in-out infinite; }
    .sway-d{ animation: swayD 6.1s ease-in-out infinite; }

    @keyframes swayA{
      0%,100%{transform: rotate(-1.2deg) translateY(0)}
      50%{transform: rotate(1.6deg) translateY(-0.4vh)}
    }
    @keyframes swayB{
      0%,100%{transform: rotate(1.1deg) translateY(0)}
      50%{transform: rotate(-1.8deg) translateY(-0.6vh)}
    }
    @keyframes swayC{
      0%,100%{transform: rotate(-0.6deg) translateY(0)}
      50%{transform: rotate(2.2deg) translateY(-0.5vh)}
    }
    @keyframes swayD{
      0%,100%{transform: rotate(1.6deg) translateY(0)}
      50%{transform: rotate(-1.1deg) translateY(-0.45vh)}
    }

    /* Grass blades (also swaying, unique eases) */
    .grass path{
      animation: grassWiggle var(--gt) ease-in-out infinite;
      transform-origin: center bottom;
    }
    @keyframes grassWiggle{
      0%,100%{transform: rotate(var(--ga1))}
      50%{transform: rotate(var(--ga2))}
    }

    /* Tiny per-part motion */
    .head-wobble{ animation: headWobble 4.9s ease-in-out infinite; transform-origin:center; }
    @keyframes headWobble{
      0%,100%{transform: rotate(-1.1deg)}
      50%{transform: rotate(1.4deg)}
    }

    /* Accessibility focus */
    .flower:focus{outline:none}
    .flower:focus-visible{filter: drop-shadow(0 0 0 rgba(0,0,0,0)) drop-shadow(0 0 0 rgba(0,0,0,0));}

    /* Small screens: keep card from overlapping the zoom target too much */
    @media (max-width: 520px){
      .ui{
        justify-content:center;
        align-items:flex-start;
        padding-top: 2.5vh;
      }
    }
  </style>
</head>
<body>
  <div class="scene">
    <div class="stars" id="stars"></div>

    <div class="garden" id="garden">
      <svg id="gardenSVG" viewBox="0 0 1000 700" preserveAspectRatio="xMidYMax slice" aria-label="Night Garden">
        <defs>
          <!-- Stem / leaf gradients -->
          <linearGradient id="stemGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0" stop-color="#3bd07b" stop-opacity=".95"/>
            <stop offset="1" stop-color="#0b7a37" stop-opacity=".95"/>
          </linearGradient>

          <!-- Tulip -->
          <linearGradient id="tulipPetal" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#b4005a"/>
            <stop offset="1" stop-color="#ff88b8"/>
          </linearGradient>
          <linearGradient id="tulipInner" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0" stop-color="#ffb1d1" stop-opacity=".95"/>
            <stop offset="1" stop-color="#c10063" stop-opacity=".95"/>
          </linearGradient>

          <!-- Lily -->
          <linearGradient id="lilyPetal" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#ffffff"/>
            <stop offset="1" stop-color="#cfe0ff"/>
          </linearGradient>
          <linearGradient id="stamenGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0" stop-color="#ffd86a"/>
            <stop offset="1" stop-color="#ff9b24"/>
          </linearGradient>

          <!-- Poppy -->
          <linearGradient id="poppyPetal" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#ff2f7a"/>
            <stop offset="1" stop-color="#ff8aa6"/>
          </linearGradient>
          <radialGradient id="poppyCenter" cx=".45" cy=".45" r=".7">
            <stop offset="0" stop-color="#fff27a"/>
            <stop offset=".55" stop-color="#b9ff62"/>
            <stop offset="1" stop-color="#3aa84a"/>
          </radialGradient>

          <!-- Sunflower -->
          <linearGradient id="sunPetal" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#ffe16a"/>
            <stop offset="1" stop-color="#ffb300"/>
          </linearGradient>
          <radialGradient id="sunCenter" cx=".5" cy=".45" r=".65">
            <stop offset="0" stop-color="#4a2b1c"/>
            <stop offset="1" stop-color="#1f120c"/>
          </radialGradient>

          <!-- Soft glow -->
          <filter id="softGlow" x="-30%" y="-30%" width="160%" height="160%">
            <feGaussianBlur stdDeviation="2.2" result="blur"/>
            <feColorMatrix in="blur" type="matrix"
              values="1 0 0 0 0
                      0 1 0 0 0
                      0 0 1 0 0
                      0 0 0 .35 0" result="glow"/>
            <feMerge>
              <feMergeNode in="glow"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <!-- Grass (minimalist paths, swaying individually) -->
        <g class="grass" opacity=".9">
          <path d="M70 700 Q80 650 95 610 Q85 650 92 700" fill="none" stroke="#0e5a2a" stroke-width="6" stroke-linecap="round"
            style="--gt:4.9s;--ga1:-2deg;--ga2:3deg"/>
          <path d="M120 700 Q130 640 140 600 Q132 650 140 700" fill="none" stroke="#0c4d24" stroke-width="5" stroke-linecap="round"
            style="--gt:6.2s;--ga1:2deg;--ga2:-3deg"/>
          <path d="M200 700 Q210 650 230 612 Q215 655 220 700" fill="none" stroke="#0f6a31" stroke-width="6" stroke-linecap="round"
            style="--gt:5.5s;--ga1:-3deg;--ga2:2deg"/>
          <path d="M820 700 Q830 650 850 612 Q835 655 840 700" fill="none" stroke="#0f6a31" stroke-width="6" stroke-linecap="round"
            style="--gt:6.9s;--ga1:3deg;--ga2:-2deg"/>
          <path d="M900 700 Q910 645 930 605 Q918 652 920 700" fill="none" stroke="#0c4d24" stroke-width="5" stroke-linecap="round"
            style="--gt:5.7s;--ga1:-2deg;--ga2:3deg"/>
        </g>

        <!-- FLOWER 1: Tulip (left) -->
        <g class="flower sway-a" id="flower-tulip" tabindex="0" role="button" aria-label="Tulip"
           data-name="Tulip" data-note="A warm cup of rose under a midnight sky."
           data-tipx="250" data-tipy="210"
           style="transform-origin: 250px 680px;">
          <!-- stem (quadratic bezier path) -->
          <path d="M250 680 Q240 520 262 380 Q275 300 255 235"
                fill="none" stroke="url(#stemGrad)" stroke-width="12" stroke-linecap="round" filter="url(#softGlow)"/>
          <!-- attached leaves (anchored to stem coords) -->
          <path d="M250 520 Q195 505 205 450 Q230 420 258 468 Q270 505 250 520Z"
                fill="url(#stemGrad)" opacity=".95"/>
          <path d="M258 450 Q315 442 320 392 Q300 360 270 402 Q252 430 258 450Z"
                fill="url(#stemGrad)" opacity=".9"/>
          <!-- head -->
          <g class="head-wobble" filter="url(#softGlow)">
            <path d="M220 270 Q250 210 280 270 Q290 320 250 338 Q210 320 220 270Z"
                  fill="url(#tulipPetal)"/>
            <path d="M240 272 Q250 235 260 272 Q266 308 250 318 Q234 308 240 272Z"
                  fill="url(#tulipInner)" opacity=".95"/>
            <path d="M205 285 Q230 250 238 300 Q235 328 210 318 Q195 305 205 285Z"
                  fill="url(#tulipPetal)" opacity=".9"/>
            <path d="M295 285 Q270 250 262 300 Q265 328 290 318 Q305 305 295 285Z"
                  fill="url(#tulipPetal)" opacity=".9"/>
          </g>
        </g>

        <!-- FLOWER 2: Lily (mid-left) -->
        <g class="flower sway-b" id="flower-lily" tabindex="0" role="button" aria-label="Lily"
           data-name="Lily" data-note="Six bright petals, like a quiet lantern."
           data-tipx="420" data-tipy="190"
           style="transform-origin: 420px 680px;">
          <path d="M420 680 Q450 520 430 390 Q418 300 422 210"
                fill="none" stroke="url(#stemGrad)" stroke-width="11" stroke-linecap="round" filter="url(#softGlow)"/>
          <!-- leaves anchored -->
          <path d="M432 500 Q500 508 505 462 Q480 430 448 460 Q425 482 432 500Z"
                fill="url(#stemGrad)" opacity=".95"/>
          <path d="M420 420 Q355 410 350 360 Q372 332 405 372 Q428 400 420 420Z"
                fill="url(#stemGrad)" opacity=".9"/>

          <g class="head-wobble" filter="url(#softGlow)">
            <!-- 6 petals (elongated, pointed) -->
            <path d="M420 205 Q405 160 420 125 Q435 160 420 205Z" fill="url(#lilyPetal)"/>
            <path d="M400 215 Q362 188 340 150 Q380 152 408 198 Q410 212 400 215Z" fill="url(#lilyPetal)" opacity=".98"/>
            <path d="M440 215 Q478 188 500 150 Q460 152 432 198 Q430 212 440 215Z" fill="url(#lilyPetal)" opacity=".98"/>
            <path d="M405 232 Q360 240 330 280 Q375 275 404 248 Q410 238 405 232Z" fill="url(#lilyPetal)" opacity=".96"/>
            <path d="M435 232 Q480 240 510 280 Q465 275 436 248 Q430 238 435 232Z" fill="url(#lilyPetal)" opacity=".96"/>
            <path d="M420 238 Q410 270 420 300 Q430 270 420 238Z" fill="url(#lilyPetal)" opacity=".94"/>

            <!-- stamens -->
            <g>
              <path d="M415 220 Q410 250 402 270" fill="none" stroke="url(#stamenGrad)" stroke-width="3.2" stroke-linecap="round"/>
              <path d="M425 220 Q432 248 440 268" fill="none" stroke="url(#stamenGrad)" stroke-width="3.2" stroke-linecap="round"/>
              <path d="M420 218 Q420 250 420 276" fill="none" stroke="url(#stamenGrad)" stroke-width="3.2" stroke-linecap="round"/>
              <path d="M397 270 Q404 264 410 270 Q404 280 397 270Z" fill="#ffb02e"/>
              <path d="M440 268 Q447 262 452 270 Q446 280 440 268Z" fill="#ffb02e"/>
              <path d="M417 276 Q422 270 428 276 Q422 286 417 276Z" fill="#ffb02e"/>
            </g>
          </g>
        </g>

        <!-- FLOWER 3: Poppy (mid-right) -->
        <g class="flower sway-c" id="flower-poppy" tabindex="0" role="button" aria-label="Poppy"
           data-name="Poppy" data-note="Soft waves of pink-red with a bright heart."
           data-tipx="650" data-tipy="230"
           style="transform-origin: 650px 680px;">
          <path d="M650 680 Q630 530 652 410 Q670 310 650 250"
                fill="none" stroke="url(#stemGrad)" stroke-width="11" stroke-linecap="round" filter="url(#softGlow)"/>
          <!-- leaves anchored -->
          <path d="M648 520 Q585 540 600 485 Q625 452 655 486 Q668 508 648 520Z"
                fill="url(#stemGrad)" opacity=".93"/>
          <path d="M655 455 Q720 452 725 405 Q705 372 670 405 Q650 428 655 455Z"
                fill="url(#stemGrad)" opacity=".88"/>

          <g class="head-wobble" filter="url(#softGlow)">
            <!-- wavy petals -->
            <path d="M610 260 Q595 210 625 190 Q645 178 660 198 Q640 220 650 250 Q632 278 610 260Z"
                  fill="url(#poppyPetal)" opacity=".97"/>
            <path d="M690 260 Q705 210 675 190 Q655 178 640 198 Q660 220 650 250 Q668 278 690 260Z"
                  fill="url(#poppyPetal)" opacity=".97"/>
            <path d="M615 285 Q600 310 620 335 Q650 360 670 335 Q695 310 685 285 Q650 300 615 285Z"
                  fill="url(#poppyPetal)" opacity=".94"/>
            <path d="M635 230 Q650 205 665 230 Q680 258 650 270 Q620 258 635 230Z"
                  fill="url(#poppyPetal)" opacity=".9"/>

            <!-- fuzzy center -->
            <circle cx="650" cy="265" r="26" fill="url(#poppyCenter)"/>
            <path d="M635 252 Q650 245 665 252 Q652 258 650 270 Q648 258 635 252Z"
                  fill="rgba(0,0,0,.18)"/>
            <g opacity=".5">
              <circle cx="640" cy="262" r="2.3" fill="rgba(0,0,0,.22)"/>
              <circle cx="660" cy="262" r="2.3" fill="rgba(0,0,0,.22)"/>
              <circle cx="650" cy="274" r="2.3" fill="rgba(0,0,0,.22)"/>
              <circle cx="646" cy="254" r="2.1" fill="rgba(0,0,0,.22)"/>
              <circle cx="654" cy="254" r="2.1" fill="rgba(0,0,0,.22)"/>
            </g>
          </g>
        </g>

        <!-- FLOWER 4: Sunflower (right) -->
        <g class="flower sway-d" id="flower-sun" tabindex="0" role="button" aria-label="Sunflower"
           data-name="Sunflower" data-note="A tiny sun, stubbornly glowing at night."
           data-tipx="820" data-tipy="210"
           style="transform-origin: 820px 680px;">
          <path d="M820 680 Q800 540 828 420 Q845 320 820 230"
                fill="none" stroke="url(#stemGrad)" stroke-width="12" stroke-linecap="round" filter="url(#softGlow)"/>

          <!-- leaves anchored -->
          <path d="M822 505 Q760 500 760 450 Q782 418 812 452 Q830 472 822 505Z"
                fill="url(#stemGrad)" opacity=".95"/>
          <path d="M830 430 Q900 440 905 392 Q880 360 848 392 Q828 410 830 430Z"
                fill="url(#stemGrad)" opacity=".88"/>

          <g class="head-wobble" filter="url(#softGlow)">
            <!-- thin radiating petals -->
            <g opacity=".98">
              <path d="M820 190 Q812 160 820 130 Q828 160 820 190Z" fill="url(#sunPetal)"/>
              <path d="M790 200 Q770 175 760 145 Q790 150 804 182 Q808 194 790 200Z" fill="url(#sunPetal)"/>
              <path d="M850 200 Q870 175 880 145 Q850 150 836 182 Q832 194 850 200Z" fill="url(#sunPetal)"/>
              <path d="M778 228 Q748 226 722 246 Q750 254 776 246 Q786 238 778 228Z" fill="url(#sunPetal)"/>
              <path d="M862 228 Q892 226 918 246 Q890 254 864 246 Q854 238 862 228Z" fill="url(#sunPetal)"/>
              <path d="M800 255 Q784 276 782 306 Q804 294 812 270 Q812 258 800 255Z" fill="url(#sunPetal)"/>
              <path d="M840 255 Q856 276 858 306 Q836 294 828 270 Q828 258 840 255Z" fill="url(#sunPetal)"/>
            </g>

            <!-- textured center -->
            <circle cx="820" cy="230" r="38" fill="url(#sunCenter)"/>
            <g opacity=".35">
              <circle cx="806" cy="222" r="2.2" fill="#000"/>
              <circle cx="830" cy="222" r="2.2" fill="#000"/>
              <circle cx="818" cy="246" r="2.4" fill="#000"/>
              <circle cx="812" cy="236" r="2.1" fill="#000"/>
              <circle cx="828" cy="236" r="2.1" fill="#000"/>
              <circle cx="820" cy="214" r="2.0" fill="#000"/>
            </g>
          </g>
        </g>
      </svg>
    </div>

    <div class="meadow"></div>

    <!-- Ribbon SVG overlay -->
    <svg class="ribbon-layer" id="ribbonSVG" viewBox="0 0 1000 700" preserveAspectRatio="none" aria-hidden="true">
      <path id="ribbonPath" class="ribbon-path" d="" />
    </svg>

    <!-- Polaroid UI -->
    <div class="ui" id="ui">
      <div class="card" id="card" aria-live="polite">
        <button class="close" id="closeBtn" aria-label="Close">
          <svg viewBox="0 0 24 24" fill="none" stroke="#0d1530" stroke-width="2.5" stroke-linecap="round">
            <path d="M6 6L18 18M18 6L6 18"></path>
          </svg>
        </button>
        <div class="photo"></div>
        <div class="caption">
          <h3 id="cardTitle">Flower</h3>
          <p id="cardNote">â€”</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Stars: tiny, lightweight DOM nodes with varied twinkle timing (no dead sky).
    (function makeStars(){
      const wrap = document.getElementById('stars');
      const N = 56;
      const rand = (a,b)=>a+Math.random()*(b-a);
      for(let i=0;i<N;i++){
        const s = document.createElement('div');
        s.className='star';
        s.style.left = rand(0,100)+'vw';
        s.style.top  = rand(0,70)+'vh';
        s.style.opacity = rand(.25,.95);
        s.style.setProperty('--tw', rand(2.6,6.8).toFixed(2)+'s');
        const size = rand(1.2,2.4);
        s.style.width = size+'px';
        s.style.height= size+'px';
        wrap.appendChild(s);
      }
    })();

    const garden = document.getElementById('garden');
    const card = document.getElementById('card');
    const titleEl = document.getElementById('cardTitle');
    const noteEl = document.getElementById('cardNote');
    const closeBtn = document.getElementById('closeBtn');

    const ribbonSVG = document.getElementById('ribbonSVG');
    const ribbonPath = document.getElementById('ribbonPath');

    let activeFlower = null;

    function setRibbon(fromX, fromY, toX, toY){
      // A soft S-curve that feels like a ribbon.
      const midX = (fromX + toX) / 2;
      const c1x = midX;
      const c1y = fromY - 90;
      const c2x = midX;
      const c2y = toY + 90;
      const d = `M ${fromX} ${fromY} C ${c1x} ${c1y}, ${c2x} ${c2y}, ${toX} ${toY}`;
      ribbonPath.setAttribute('d', d);

      // Draw animation via stroke-dash.
      const len = ribbonPath.getTotalLength();
      ribbonPath.style.strokeDasharray = String(len);
      ribbonPath.style.strokeDashoffset = String(len);
      ribbonPath.getBoundingClientRect(); // force reflow
      ribbonPath.style.transition = 'stroke-dashoffset 650ms ease-in-out';
      ribbonPath.style.strokeDashoffset = '0';
    }

    function clearRibbon(){
      ribbonPath.style.transition = 'none';
      ribbonPath.setAttribute('d','');
      ribbonPath.style.strokeDasharray = '0';
      ribbonPath.style.strokeDashoffset = '0';
    }

    function zoomToFlower(flower){
      const sceneRect = garden.getBoundingClientRect();
      const tipX = Number(flower.dataset.tipx);
      const tipY = Number(flower.dataset.tipy);

      // Convert tip (SVG viewBox coords) to scene pixels.
      // gardenSVG viewBox is 1000x700 and fills the garden container.
      const px = sceneRect.left + (tipX/1000) * sceneRect.width;
      const py = sceneRect.top  + (tipY/700)  * sceneRect.height;

      // Move that point toward a pleasing focus area (slightly left of center so card can sit on the right).
      const targetX = sceneRect.left + sceneRect.width * 0.38;
      const targetY = sceneRect.top  + sceneRect.height* 0.40;

      const dx = (targetX - px);
      const dy = (targetY - py);

      const scale = 1.55; // smooth zoom
      garden.classList.add('is-zoomed');
      garden.style.transform = `translate(${dx}px, ${dy}px) scale(${scale})`;
      garden.classList.add('is-zoomed');
      garden.classList.add('is-zoomed');

      // Reveal card
      titleEl.textContent = flower.dataset.name || 'Flower';
      noteEl.textContent = flower.dataset.note || '';
      card.classList.add('show');

      // Ribbon: from stem tip to left edge of card (real-time via getBoundingClientRect)
      requestAnimationFrame(()=>{
        const cardRect = card.getBoundingClientRect();

        // Ribbon start: stem tip in viewport coords
        const fromVX = px;
        const fromVY = py;

        // Ribbon end: left edge mid-ish of card
        const toVX = cardRect.left;
        const toVY = cardRect.top + Math.min(cardRect.height * 0.35, 90);

        // Convert viewport coords into ribbonSVG viewBox coords (1000x700)
        const ribbonRect = ribbonSVG.getBoundingClientRect();
        const vxToSvgX = (v)=> ( (v - ribbonRect.left) / ribbonRect.width ) * 1000;
        const vyToSvgY = (v)=> ( (v - ribbonRect.top ) / ribbonRect.height) * 700;

        setRibbon(
          vxToSvgX(fromVX), vyToSvgY(fromVY),
          vxToSvgX(toVX),   vyToSvgY(toVY)
        );
      });
    }

    function resetView(){
      activeFlower = null;
      garden.classList.remove('is-zoomed');
      garden.style.transform = '';
      card.classList.remove('show');
      clearRibbon();
    }

    function onFlowerActivate(flower){
      activeFlower = flower;
      zoomToFlower(flower);
    }

    // Click handlers
    document.querySelectorAll('.flower').forEach(f=>{
      f.addEventListener('click', (e)=>{
        e.stopPropagation();
        onFlowerActivate(f);
      });
      // keyboard activate
      f.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          onFlowerActivate(f);
        }
      });
    });

    // Close button (must remain clickable)
    closeBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      resetView();
    });

    // Click outside closes (but don't block close button)
    document.addEventListener('click', (e)=>{
      if(!activeFlower) return;
      // If clicking inside the card, ignore.
      if(card.contains(e.target)) return;
      resetView();
    });

    // Keep ribbon connected on resize
    window.addEventListener('resize', ()=>{
      if(!activeFlower) return;
      clearRibbon();
      zoomToFlower(activeFlower);
    }, {passive:true});
  </script>
</body>
</html>
